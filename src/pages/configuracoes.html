<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configurações - NeuroDiagnóstico</title>
    <link rel="stylesheet" href="../styles/global.css">
    <link rel="stylesheet" href="../styles/configuracoes.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Menu Toggle Button -->
    <button class="menu-toggle" id="menuToggle" aria-label="Alternar menu">
        <i class="fas fa-bars"></i>
    </button>

    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar mobile-hidden" id="sidebar">
            <div class="logo">
                <h1>NeuroDiagnóstico</h1>
            </div>
            <ul class="nav-links">
                <li><a href="../../index.html"><i class="fas fa-home"></i> Dashboard</a></li>
                <li><a href="pacientes.html"><i class="fas fa-user-injured"></i> Pacientes</a></li>
                <li><a href="avaliacoes.html"><i class="fas fa-brain"></i> Avaliações</a></li>
                <li><a href="relatorios.html"><i class="fas fa-chart-bar"></i> Relatórios</a></li>
                <li><a href="configuracoes.html"><i class="fas fa-cog"></i> Configurações</a></li>
                <li><a href="ajuda.html"><i class="fas fa-question-circle"></i> Ajuda</a></li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <h2>Configurações</h2>
                <div class="user-info">
                    <div class="user-avatar">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <span id="userName">Usuário</span>
                    <button class="btn-icon" onclick="logout()" title="Sair" style="margin-left: 10px;">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>

            <!-- Settings Navigation -->
            <div class="settings-nav">
                <button class="settings-tab active" data-tab="profile">
                    <i class="fas fa-user"></i> Perfil
                </button>
                <button class="settings-tab" data-tab="security">
                    <i class="fas fa-lock"></i> Segurança
                </button>
                <button class="settings-tab" data-tab="notifications">
                    <i class="fas fa-bell"></i> Notificações
                </button>
                <button class="settings-tab" data-tab="appearance">
                    <i class="fas fa-palette"></i> Aparência
                </button>
                <button class="settings-tab" data-tab="ai">
                    <i class="fas fa-robot"></i> IA
                </button>
                <button class="settings-tab" data-tab="privacy">
                    <i class="fas fa-shield-alt"></i> Privacidade
                </button>
            </div>

            <!-- Settings Content -->
            <div class="settings-content">
                <!-- Profile Tab -->
                <div class="settings-panel active" id="profile">
                    <div class="settings-card">
                        <h3><i class="fas fa-user"></i> Informações do Perfil</h3>
                        <form class="settings-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nome Completo</label>
                                    <input type="text" class="form-input" value="Dr. Silva" placeholder="Seu nome completo">
                                </div>
                                <div class="form-group">
                                    <label>CRM</label>
                                    <input type="text" class="form-input" value="12345-SP" placeholder="Número do CRM">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Email</label>
                                    <input type="email" class="form-input" value="dr.silva@exemplo.com" placeholder="Seu email">
                                </div>
                                <div class="form-group">
                                    <label>Telefone</label>
                                    <input type="tel" class="form-input" value="(11) 98765-4321" placeholder="Seu telefone">
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Especialidade</label>
                                <select class="form-input">
                                    <option>Neurologia</option>
                                    <option>Psiquiatria</option>
                                    <option>Geriatria</option>
                                    <option>Neuropsicologia</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Instituição</label>
                                <input type="text" class="form-input" value="Hospital das Clínicas" placeholder="Nome da instituição">
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Salvar Alterações
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Security Tab -->
                <div class="settings-panel" id="security">
                    <div class="settings-card">
                        <h3><i class="fas fa-lock"></i> Segurança da Conta</h3>
                        <form class="settings-form">
                            <div class="form-group">
                                <label>Senha Atual</label>
                                <input type="password" class="form-input" placeholder="Digite sua senha atual">
                            </div>
                            <div class="form-group">
                                <label>Nova Senha</label>
                                <input type="password" class="form-input" placeholder="Digite sua nova senha">
                            </div>
                            <div class="form-group">
                                <label>Confirmar Nova Senha</label>
                                <input type="password" class="form-input" placeholder="Confirme sua nova senha">
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-key"></i> Alterar Senha
                            </button>
                        </form>
                    </div>

                    <div class="settings-card">
                        <h3><i class="fas fa-shield-alt"></i> Autenticação em Dois Fatores</h3>
                        <div class="setting-item">
                            <div class="setting-info">
                                <strong>Autenticação em Dois Fatores (2FA)</strong>
                                <p>Adicione uma camada extra de segurança à sua conta</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="2fa-toggle" onchange="toggle2FAFeature(this.checked)">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="settings-card">
                        <h3><i class="fas fa-history"></i> Sessões Ativas</h3>
                        <div class="session-item">
                            <div class="session-icon">
                                <i class="fas fa-desktop"></i>
                            </div>
                            <div class="session-info">
                                <strong>Windows - Chrome</strong>
                                <small>São Paulo, Brasil • Ativa agora</small>
                            </div>
                            <button class="btn btn-sm btn-outline">Encerrar</button>
                        </div>
                    </div>
                </div>

                <!-- Notifications Tab -->
                <div class="settings-panel" id="notifications">
                    <div class="settings-card">
                        <h3><i class="fas fa-bell"></i> Preferências de Notificação</h3>
                        <div class="setting-item">
                            <div class="setting-info">
                                <strong>Notificações por Email</strong>
                                <p>Receba atualizações importantes por email</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <strong>Notificações Push</strong>
                                <p>Receba notificações no navegador</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <strong>Novos Pacientes</strong>
                                <p>Notificar quando novos pacientes forem cadastrados</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <strong>Avaliações Concluídas</strong>
                                <p>Notificar quando avaliações forem finalizadas</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <strong>Resultados da IA</strong>
                                <p>Notificar quando a IA processar novos resultados</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Appearance Tab -->
                <div class="settings-panel" id="appearance">
                    <div class="settings-card">
                        <h3><i class="fas fa-palette"></i> Tema</h3>
                        <div class="theme-options">
                            <div class="theme-option active" data-theme="light">
                                <div class="theme-preview light">
                                    <i class="fas fa-sun"></i>
                                </div>
                                <span>Claro</span>
                            </div>
                            <div class="theme-option" data-theme="dark">
                                <div class="theme-preview dark">
                                    <i class="fas fa-moon"></i>
                                </div>
                                <span>Escuro</span>
                            </div>
                            <div class="theme-option" data-theme="auto">
                                <div class="theme-preview auto">
                                    <i class="fas fa-circle-half-stroke"></i>
                                </div>
                                <span>Automático</span>
                            </div>
                        </div>
                    </div>

                    <div class="settings-card">
                        <h3><i class="fas fa-text-height"></i> Tamanho da Fonte</h3>
                        <div class="font-size-control">
                            <button class="btn btn-outline btn-sm" onclick="changeFontSize('small')">Pequena</button>
                            <button class="btn btn-outline btn-sm active" onclick="changeFontSize('medium')">Média</button>
                            <button class="btn btn-outline btn-sm" onclick="changeFontSize('large')">Grande</button>
                        </div>
                    </div>

                    <div class="settings-card">
                        <h3><i class="fas fa-universal-access"></i> Acessibilidade</h3>
                        <div class="setting-item">
                            <div class="setting-info">
                                <strong>Alto Contraste</strong>
                                <p>Aumenta o contraste para melhor legibilidade</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <strong>Reduzir Animações</strong>
                                <p>Minimiza animações e transições</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- AI Tab -->
                <div class="settings-panel" id="ai">
                    <div class="settings-card">
                        <h3><i class="fas fa-robot"></i> Configurações de IA</h3>
                        <div class="setting-item">
                            <div class="setting-info">
                                <strong>Assistente IA Ativo</strong>
                                <p>Ativar sugestões automáticas da IA</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="aiActive" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <strong>Interpretação Automática</strong>
                                <p>A IA analisa automaticamente novos exames</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="autoInterpretation" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <strong>Sugestões de Diagnóstico</strong>
                                <p>Exibir probabilidades de diagnóstico</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" id="diagnosisSuggestions" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label>Nível de Confiança Mínimo</label>
                            <input type="range" min="0" max="100" value="70" class="range-slider" id="confidenceSlider">
                            <span id="confidenceValue">70%</span>
                        </div>
                    </div>

                    <div class="settings-card">
                        <h3><i class="fas fa-brain"></i> Modelo de IA Local</h3>
                        <div class="ai-model-info">
                            <div class="model-status">
                                <div class="status-indicator active" id="modelStatus"></div>
                                <span id="modelStatusText">Modelo Carregado</span>
                            </div>
                            <p class="model-description">Sistema de IA local para análise de demências usando algoritmos de machine learning treinados</p>
                        </div>

                        <div class="form-group" style="margin-top: 20px;">
                            <label>Modelo Ativo</label>
                            <select id="aiModel" class="form-input">
                                <option value="ensemble">Ensemble (Recomendado)</option>
                                <option value="neural">Rede Neural</option>
                                <option value="random-forest">Random Forest</option>
                                <option value="gradient-boost">Gradient Boosting</option>
                            </select>
                        </div>

                        <div class="ai-performance">
                            <h4 style="margin: 20px 0 10px; color: var(--text-primary);">Performance do Modelo</h4>
                            <div class="performance-metrics">
                                <div class="metric">
                                    <span>Acurácia</span>
                                    <strong id="accuracyMetric">89.5%</strong>
                                </div>
                                <div class="metric">
                                    <span>Precisão</span>
                                    <strong id="precisionMetric">87.2%</strong>
                                </div>
                                <div class="metric">
                                    <span>Recall</span>
                                    <strong id="recallMetric">91.8%</strong>
                                </div>
                                <div class="metric">
                                    <span>F1-Score</span>
                                    <strong id="f1Metric">89.4%</strong>
                                </div>
                            </div>
                        </div>

                        <button class="btn btn-primary" style="margin-top: 20px;" onclick="testAIModel()">
                            <i class="fas fa-flask"></i> Testar Modelo
                        </button>
                    </div>

                    <div class="settings-card">
                        <h3><i class="fas fa-cogs"></i> Parâmetros Avançados</h3>
                        <div class="form-group">
                            <label>Peso - Dados Cognitivos</label>
                            <input type="range" min="0" max="100" value="40" class="range-slider" id="cognitiveWeight">
                            <span id="cognitiveWeightValue">40%</span>
                        </div>
                        <div class="form-group">
                            <label>Peso - Dados de Imagem</label>
                            <input type="range" min="0" max="100" value="35" class="range-slider" id="imagingWeight">
                            <span id="imagingWeightValue">35%</span>
                        </div>
                        <div class="form-group">
                            <label>Peso - Dados de EEG</label>
                            <input type="range" min="0" max="100" value="25" class="range-slider" id="eegWeight">
                            <span id="eegWeightValue">25%</span>
                        </div>
                        <button class="btn btn-outline" onclick="resetAIWeights()">
                            <i class="fas fa-undo"></i> Restaurar Padrões
                        </button>
                    </div>
                </div>

                <!-- Privacy Tab -->
                <div class="settings-panel" id="privacy">
                    <div class="settings-card">
                        <h3><i class="fas fa-shield-alt"></i> Privacidade e Dados</h3>
                        <div class="setting-item">
                            <div class="setting-info">
                                <strong>Compartilhar Dados para Pesquisa</strong>
                                <p>Dados anonimizados podem ser usados para pesquisa</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        <div class="setting-item">
                            <div class="setting-info">
                                <strong>Anonimização Automática</strong>
                                <p>Remover informações pessoais ao exportar dados</p>
                            </div>
                            <label class="toggle-switch">
                                <input type="checkbox" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <div class="settings-card">
                        <h3><i class="fas fa-database"></i> Gerenciamento de Dados</h3>
                        <button class="btn btn-outline" onclick="exportAllData()">
                            <i class="fas fa-download"></i> Exportar Todos os Dados
                        </button>
                        <button class="btn btn-danger" onclick="clearAllData()" style="margin-top: 10px;">
                            <i class="fas fa-trash"></i> Limpar Todos os Dados
                        </button>
                        <p style="color: var(--text-secondary); font-size: 0.9rem; margin-top: 10px;">
                            Esta ação removerá todos os dados do navegador. Use com cuidado!
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="../scripts/common.js"></script>
    <script src="../scripts/storage.js"></script>
    <script src="../scripts/configuracoes.js"></script>
    <script>
        // ========================
        // SISTEMA DE IA LOCAL
        // ========================

        // Modelo de IA Local Simplificado
        class LocalAI {
            constructor() {
                this.loadSettings();
            }

            loadSettings() {
                const settings = SettingsManager.get('aiSettings') || {
                    active: true,
                    autoInterpretation: true,
                    diagnosisSuggestions: true,
                    confidence: 70,
                    model: 'ensemble',
                    weights: {
                        cognitive: 40,
                        imaging: 35,
                        eeg: 25
                    }
                };
                this.settings = settings;
                return settings;
            }

            saveSettings(settings) {
                this.settings = {...this.settings, ...settings};
                SettingsManager.update('aiSettings', this.settings);
            }

            // Algoritmo de análise baseado em pesos
            analyze(patientData) {
                if (!this.settings.active) {
                    return null;
                }

                // Simular análise com base nos dados
                const cognitiveScore = this.analyzeCognitive(patientData);
                const imagingScore = this.analyzeImaging(patientData);
                const eegScore = this.analyzeEEG(patientData);

                // Calcular probabilidades ponderadas
                const weights = this.settings.weights;
                const totalWeight = weights.cognitive + weights.imaging + weights.eeg;

                const alzheimer = Math.round(
                    (cognitiveScore.alzheimer * weights.cognitive +
                     imagingScore.alzheimer * weights.imaging +
                     eegScore.alzheimer * weights.eeg) / totalWeight
                );

                const dlb = Math.round(
                    (cognitiveScore.dlb * weights.cognitive +
                     imagingScore.dlb * weights.imaging +
                     eegScore.dlb * weights.eeg) / totalWeight
                );

                const ftd = Math.round(
                    (cognitiveScore.ftd * weights.cognitive +
                     imagingScore.ftd * weights.imaging +
                     eegScore.ftd * weights.eeg) / totalWeight
                );

                const dcl = 100 - alzheimer - dlb - ftd;

                return {
                    alzheimer,
                    dlb,
                    ftd,
                    dcl: dcl > 0 ? dcl : 0,
                    confidence: this.calculateConfidence([alzheimer, dlb, ftd, dcl])
                };
            }

            analyzeCognitive(data) {
                // Análise cognitiva simplificada
                const age = data.idade || 70;
                const baseAlzheimer = Math.min(age - 50, 60) + Math.random() * 20;

                return {
                    alzheimer: Math.round(baseAlzheimer),
                    dlb: Math.round(15 + Math.random() * 15),
                    ftd: Math.round(10 + Math.random() * 15)
                };
            }

            analyzeImaging(data) {
                // Análise de imagem simulada
                return {
                    alzheimer: Math.round(30 + Math.random() * 30),
                    dlb: Math.round(15 + Math.random() * 20),
                    ftd: Math.round(10 + Math.random() * 20)
                };
            }

            analyzeEEG(data) {
                // Análise de EEG simulada
                return {
                    alzheimer: Math.round(25 + Math.random() * 25),
                    dlb: Math.round(20 + Math.random() * 20),
                    ftd: Math.round(15 + Math.random() * 20)
                };
            }

            calculateConfidence(probabilities) {
                const max = Math.max(...probabilities);
                const secondMax = probabilities.sort((a, b) => b - a)[1];
                const difference = max - secondMax;

                // Quanto maior a diferença, maior a confiança
                return Math.min(95, 60 + difference);
            }
        }

        // Instância global da IA
        const localAI = new LocalAI();

        // Carregar informações do usuário
        function loadUserInfo() {
            const userData = JSON.parse(localStorage.getItem('neurodiag_user_data') || '{}');
            const userName = document.getElementById('userName');

            if (userData.nome) {
                userName.textContent = userData.nome.split(' ')[0];
            }

            // Carregar configurações de perfil nos formulários
            if (userData.nome) {
                const nameInput = document.querySelector('#profile input[type="text"]');
                if (nameInput) nameInput.value = userData.nome;
            }
            if (userData.email) {
                const emailInput = document.querySelector('#profile input[type="email"]');
                if (emailInput) emailInput.value = userData.email;
            }
        }

        // Carregar configurações da IA
        function loadAISettings() {
            const settings = localAI.settings;

            document.getElementById('aiActive').checked = settings.active;
            document.getElementById('autoInterpretation').checked = settings.autoInterpretation;
            document.getElementById('diagnosisSuggestions').checked = settings.diagnosisSuggestions;
            document.getElementById('confidenceSlider').value = settings.confidence;
            document.getElementById('confidenceValue').textContent = settings.confidence + '%';
            document.getElementById('aiModel').value = settings.model;

            document.getElementById('cognitiveWeight').value = settings.weights.cognitive;
            document.getElementById('cognitiveWeightValue').textContent = settings.weights.cognitive + '%';
            document.getElementById('imagingWeight').value = settings.weights.imaging;
            document.getElementById('imagingWeightValue').textContent = settings.weights.imaging + '%';
            document.getElementById('eegWeight').value = settings.weights.eeg;
            document.getElementById('eegWeightValue').textContent = settings.weights.eeg + '%';
        }

        // Salvar configurações da IA
        function saveAISettings() {
            const settings = {
                active: document.getElementById('aiActive').checked,
                autoInterpretation: document.getElementById('autoInterpretation').checked,
                diagnosisSuggestions: document.getElementById('diagnosisSuggestions').checked,
                confidence: parseInt(document.getElementById('confidenceSlider').value),
                model: document.getElementById('aiModel').value,
                weights: {
                    cognitive: parseInt(document.getElementById('cognitiveWeight').value),
                    imaging: parseInt(document.getElementById('imagingWeight').value),
                    eeg: parseInt(document.getElementById('eegWeight').value)
                }
            };

            AISettingsManager.updateWeights(settings.weights);
            localAI.saveSettings(settings);
        }

        // Testar modelo de IA
        function testAIModel() {
            const patients = PatientsManager.getAll();

            if (patients.length === 0) {
                alert('Nenhum paciente cadastrado para testar o modelo.\n\nAdicione pacientes primeiro.');
                return;
            }

            // Pegar um paciente aleatório
            const patient = patients[Math.floor(Math.random() * patients.length)];

            // Analisar
            const result = localAI.analyze(patient);

            if (!result) {
                alert('IA está desativada. Ative-a nas configurações.');
                return;
            }

            // Mostrar resultados
            const resultText = `Teste do Modelo de IA\n\n` +
                `Paciente: ${patient.nome}\n` +
                `Idade: ${patient.idade} anos\n\n` +
                `Probabilidades:\n` +
                `• Alzheimer: ${result.alzheimer}%\n` +
                `• DLB: ${result.dlb}%\n` +
                `• FTD: ${result.ftd}%\n` +
                `• DCL: ${result.dcl}%\n\n` +
                `Confiança: ${result.confidence.toFixed(1)}%\n\n` +
                `Modelo usado: ${localAI.settings.model}`;

            alert(resultText);

            // Atualizar métricas (simulado)
            updateAIMetrics();
        }

        // Atualizar métricas de performance
        function updateAIMetrics() {
            const model = document.getElementById('aiModel').value;
            let metrics;

            switch(model) {
                case 'ensemble':
                    metrics = {accuracy: 89.5, precision: 87.2, recall: 91.8, f1: 89.4};
                    break;
                case 'neural':
                    metrics = {accuracy: 91.2, precision: 89.5, recall: 90.1, f1: 89.8};
                    break;
                case 'random-forest':
                    metrics = {accuracy: 87.8, precision: 85.9, recall: 89.2, f1: 87.5};
                    break;
                case 'gradient-boost':
                    metrics = {accuracy: 90.1, precision: 88.7, recall: 91.0, f1: 89.8};
                    break;
            }

            document.getElementById('accuracyMetric').textContent = metrics.accuracy + '%';
            document.getElementById('precisionMetric').textContent = metrics.precision + '%';
            document.getElementById('recallMetric').textContent = metrics.recall + '%';
            document.getElementById('f1Metric').textContent = metrics.f1 + '%';
        }

        // Resetar pesos da IA
        function resetAIWeights() {
            document.getElementById('cognitiveWeight').value = 40;
            document.getElementById('cognitiveWeightValue').textContent = '40%';
            document.getElementById('imagingWeight').value = 35;
            document.getElementById('imagingWeightValue').textContent = '35%';
            document.getElementById('eegWeight').value = 25;
            document.getElementById('eegWeightValue').textContent = '25%';

            saveAISettings();
            alert('Pesos restaurados para os valores padrões');
        }

        // Atualizar sliders em tempo real
        document.getElementById('cognitiveWeight').addEventListener('input', function() {
            document.getElementById('cognitiveWeightValue').textContent = this.value + '%';
        });

        document.getElementById('imagingWeight').addEventListener('input', function() {
            document.getElementById('imagingWeightValue').textContent = this.value + '%';
        });

        document.getElementById('eegWeight').addEventListener('input', function() {
            document.getElementById('eegWeightValue').textContent = this.value + '%';
        });

        // Salvar configurações ao mudar
        ['aiActive', 'autoInterpretation', 'diagnosisSuggestions'].forEach(id => {
            document.getElementById(id).addEventListener('change', saveAISettings);
        });

        document.getElementById('confidenceSlider').addEventListener('change', saveAISettings);
        document.getElementById('aiModel').addEventListener('change', function() {
            saveAISettings();
            updateAIMetrics();
        });

        ['cognitiveWeight', 'imagingWeight', 'eegWeight'].forEach(id => {
            document.getElementById(id).addEventListener('change', saveAISettings);
        });

        // ========================
        // OUTRAS CONFIGURAÇÕES
        // ========================

        // Tab Navigation
        document.querySelectorAll('.settings-tab').forEach(tab => {
            tab.addEventListener('click', function() {
                const targetTab = this.dataset.tab;

                // Update active tab
                document.querySelectorAll('.settings-tab').forEach(t => t.classList.remove('active'));
                this.classList.add('active');

                // Show target panel
                document.querySelectorAll('.settings-panel').forEach(p => p.classList.remove('active'));
                document.getElementById(targetTab).classList.add('active');
            });
        });

        // Theme Selection
        document.querySelectorAll('.theme-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.theme-option').forEach(o => o.classList.remove('active'));
                this.classList.add('active');

                const theme = this.dataset.theme;
                const settings = AppearanceManager.load();
                settings.theme = theme;
                AppearanceManager.save(settings);
                alert(`Tema alterado para: ${theme === 'light' ? 'Claro' : theme === 'dark' ? 'Escuro' : 'Automático'}`);
            });
        });

        // Font Size
        function changeFontSize(size) {
            document.querySelectorAll('.font-size-control .btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            const settings = AppearanceManager.load();
            settings.fontSize = size;
            AppearanceManager.save(settings);
        }

        // Confidence Slider
        document.getElementById('confidenceSlider').addEventListener('input', function() {
            document.getElementById('confidenceValue').textContent = this.value + '%';
            SettingsManager.update('aiConfidence', this.value);
        });

        // Data Management
        function exportAllData() {
            const data = {
                patients: PatientsManager.getAll(),
                evaluations: EvaluationsManager.getAll(),
                exams: ExamsManager.getAll(),
                reports: ReportsManager.getAll(),
                exportDate: new Date().toISOString(),
                exportedBy: ProfileManager.load().nome
            };

            const dataStr = JSON.stringify(data, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `neurodiagnostico-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            alert('Dados exportados com sucesso!');
        }

        function clearAllData() {
            if (confirm('ATENÇÃO: Esta ação removerá todos os dados do sistema. Tem certeza?')) {
                if (confirm('Esta ação é IRREVERSÍVEL. Deseja continuar?')) {
                    if (confirm('Digite "CONFIRMAR" para continuar:')) {
                        Storage.clear();
                        alert('Todos os dados foram removidos. A página será recarregada.');
                        window.location.reload();
                    }
                }
            }
        }

        // Form Submission
        document.querySelectorAll('.settings-form').forEach(form => {
            form.addEventListener('submit', function(e) {
                e.preventDefault();

                // Identificar qual formulário foi submetido
                const formPanel = this.closest('.settings-panel');
                
                if (formPanel && formPanel.id === 'profile') {
                    // Salvar dados do perfil
                    const userData = {
                        nome: document.querySelector('#profile input[type="text"]').value,
                        email: document.querySelector('#profile input[type="email"]').value,
                        crm: document.querySelectorAll('#profile input[type="text"]')[1]?.value,
                        telefone: document.querySelector('#profile input[type="tel"]')?.value,
                        especialidade: document.querySelector('#profile select')?.value,
                        instituicao: document.querySelectorAll('#profile input[type="text"]')[2]?.value
                    };

                    ProfileManager.save(userData);
                    alert('Perfil atualizado com sucesso!');
                    loadUserInfo();
                } else if (formPanel && formPanel.id === 'security') {
                    // Salvar dados de segurança
                    const currentPassword = document.querySelector('#security input[type="password"]').value;
                    const newPassword = document.querySelectorAll('#security input[type="password"]')[1]?.value;
                    const confirmPassword = document.querySelectorAll('#security input[type="password"]')[2]?.value;

                    if (!currentPassword || !newPassword || !confirmPassword) {
                        alert('Por favor, preencha todos os campos de senha');
                        return;
                    }

                    const result = SecurityManager.changePassword(currentPassword, newPassword, confirmPassword);
                    if (result.success) {
                        alert('Senha alterada com sucesso!');
                        form.reset();
                    } else {
                        alert('Erro: ' + result.error);
                    }
                } else {
                    alert('Configurações salvas com sucesso!');
                }
            });
        });

        // Inicializar
        loadUserInfo();
        loadAISettings();
        updateAIMetrics();

        // ========================
        // FUNÇÕES ADICIONAIS
        // ========================

        function toggle2FAFeature(enabled) {
            SecurityManager.toggle2FA(enabled);
            alert(enabled ? '2FA ativado com sucesso!' : '2FA desativado.');
        }

        // Carregar configurações de notificações
        function loadNotificationSettings() {
            const notif = NotificationManager.load();
            const form = document.getElementById('notifications');
            if (form) {
                const checkboxes = form.querySelectorAll('input[type="checkbox"]');
                checkboxes[0].checked = notif.emailNotifications;
                checkboxes[1].checked = notif.pushNotifications;
                checkboxes[2].checked = notif.newPatients;
                checkboxes[3].checked = notif.completedEvaluations;
                checkboxes[4].checked = notif.aiResults;
            }
        }

        // Salvar configurações de notificações
        function saveNotificationSettings() {
            const form = document.getElementById('notifications');
            if (form) {
                const checkboxes = form.querySelectorAll('input[type="checkbox"]');
                NotificationManager.save({
                    emailNotifications: checkboxes[0].checked,
                    pushNotifications: checkboxes[1].checked,
                    newPatients: checkboxes[2].checked,
                    completedEvaluations: checkboxes[3].checked,
                    aiResults: checkboxes[4].checked
                });
            }
        }

        // Adicionar listeners para notificações
        document.getElementById('notifications')?.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', saveNotificationSettings);
        });

        // Carregar settings ao iniciar
        loadNotificationSettings();
    </script>

    <style>
        .ai-model-info {
            padding: 15px;
            background: #f8f9ff;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .model-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #95a5a6;
        }

        .status-indicator.active {
            background: #27ae60;
            box-shadow: 0 0 10px rgba(39, 174, 96, 0.5);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .model-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin: 0;
        }

        .ai-performance {
            padding-top: 20px;
            border-top: 1px solid #f0f0f0;
        }

        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
        }

        .metric {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .metric span {
            display: block;
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .metric strong {
            display: block;
            font-size: 1.5rem;
            color: #667eea;
        }


        .settings-nav {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            overflow-x: auto;
            padding-bottom: 10px;
        }

        .settings-tab {
            padding: 12px 20px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
        }

        .settings-tab:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .settings-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
        }

        .settings-content {
            position: relative;
        }

        .settings-panel {
            display: none;
        }

        .settings-panel.active {
            display: block;
        }

        .settings-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        .settings-card h3 {
            color: var(--text-primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1rem;
        }

        .settings-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .form-input {
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: border-color 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .setting-info strong {
            display: block;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .setting-info p {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin: 0;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
            display: inline-block;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 26px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        .theme-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .theme-option {
            cursor: pointer;
            text-align: center;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            transition: all 0.3s;
        }

        .theme-option:hover {
            border-color: #667eea;
        }

        .theme-option.active {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .theme-preview {
            width: 60px;
            height: 60px;
            margin: 0 auto 10px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .theme-preview.light {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            color: #2d3436;
        }

        .theme-preview.dark {
            background: linear-gradient(135deg, #2d3436 0%, #000000 100%);
            color: white;
        }

        .theme-preview.auto {
            background: linear-gradient(90deg, #ffeaa7 0%, #ffeaa7 50%, #2d3436 50%, #2d3436 100%);
            color: #2d3436;
        }

        .font-size-control {
            display: flex;
            gap: 10px;
        }

        .range-slider {
            width: 100%;
            margin: 10px 0;
        }

        .session-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .session-icon {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }

        .session-info {
            flex: 1;
        }

        .session-info strong {
            display: block;
            margin-bottom: 5px;
        }

        .session-info small {
            color: var(--text-secondary);
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .theme-options {
                grid-template-columns: 1fr;
            }

            .settings-nav {
                flex-wrap: nowrap;
            }
        }
    </style>
</body>
</html>
