<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avaliações - NeuroDiagnóstico</title>
    <link rel="stylesheet" href="../styles/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <!-- Menu Toggle Button -->
    <button class="menu-toggle" id="menuToggle" aria-label="Alternar menu">
        <i class="fas fa-bars"></i>
    </button>

    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar mobile-hidden" id="sidebar">
            <div class="logo">
                <h1>NeuroDiagnóstico</h1>
            </div>
            <ul class="nav-links">
                <li><a href="../../index.html"><i class="fas fa-home"></i> Dashboard</a></li>
                <li><a href="pacientes.html"><i class="fas fa-user-injured"></i> Pacientes</a></li>
                <li><a href="avaliacoes.html"><i class="fas fa-brain"></i> Avaliações</a></li>
                <li><a href="relatorios.html"><i class="fas fa-chart-bar"></i> Relatórios</a></li>
                <li><a href="configuracoes.html"><i class="fas fa-cog"></i> Configurações</a></li>
                <li><a href="ajuda.html"><i class="fas fa-question-circle"></i> Ajuda</a></li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <h2>Avaliações Neurológicas</h2>
                <div class="user-info">
                    <div class="user-avatar">
                        <img src="https://i.pravatar.cc/150?img=12" alt="Dr. Silva">
                    </div>
                    <span>Dr. Silva</span>
                </div>
            </div>

            <!-- Filter Section -->
            <div class="stats-grid" style="margin-bottom: 30px;">
                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <i class="fas fa-clipboard-list"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="totalEvaluations">0</h3>
                        <p>Total de Avaliações</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="pendingEvaluations">0</h3>
                        <p>Pendentes</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="completedEvaluations">0</h3>
                        <p>Concluídas</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                        <i class="fas fa-brain"></i>
                    </div>
                    <div class="stat-content">
                        <h3 id="aiEvaluations">0</h3>
                        <p>Com IA</p>
                    </div>
                </div>
            </div>

            <!-- Search and Filter -->
            <div class="search-section">
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" id="searchInput" placeholder="Buscar por paciente ou tipo de avaliação..." class="search-input">
                </div>
                <div class="exam-filters">
                    <button class="filter-btn active" data-type="all">Todos</button>
                    <button class="filter-btn" data-type="cognitive"><i class="fas fa-brain"></i> Cognitiva</button>
                    <button class="filter-btn" data-type="neurological"><i class="fas fa-wave-square"></i> Neurológica</button>
                    <button class="filter-btn" data-type="imaging"><i class="fas fa-x-ray"></i> Imagem</button>
                </div>
            </div>

            <!-- Evaluations Grid -->
            <div class="evaluations-grid" id="evaluationsGrid">
                <!-- Cards serão inseridos dinamicamente -->
            </div>

            <!-- Pagination -->
            <div class="pagination" style="margin-top: 30px;">
                <button class="btn btn-outline btn-sm" id="prevPage">
                    <i class="fas fa-chevron-left"></i> Anterior
                </button>
                <span class="pagination-info" id="pageInfo">Página 1 de 1</span>
                <button class="btn btn-outline btn-sm" id="nextPage">
                    Próxima <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Evaluation Detail Modal -->
    <div id="evaluationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Detalhes da Avaliação</h3>
                <button class="close-btn" onclick="closeEvaluationModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="evaluationModalContent">
                <!-- Conteúdo será inserido dinamicamente -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeEvaluationModal()">Fechar</button>
                <button class="btn btn-primary" onclick="editEvaluation()">
                    <i class="fas fa-edit"></i> Editar
                </button>
            </div>
        </div>
    </div>

    <script src="../scripts/storage.js"></script>
    <script src="../scripts/script.js"></script>
    <script>
        let currentPage = 1;
        const itemsPerPage = 9;
        let allEvaluations = [];
        let filteredEvaluations = [];
        let currentFilter = 'all';

        // Carregar avaliações
        function loadEvaluations() {
            allEvaluations = EvaluationsManager.getAll();
            filteredEvaluations = allEvaluations;
            updateStats();
            renderEvaluations();
        }

        // Atualizar estatísticas
        function updateStats() {
            document.getElementById('totalEvaluations').textContent = allEvaluations.length;

            const pending = allEvaluations.filter(e => e.status === 'Pendente').length;
            document.getElementById('pendingEvaluations').textContent = pending;

            const completed = allEvaluations.filter(e => e.status === 'Concluída').length;
            document.getElementById('completedEvaluations').textContent = completed;

            const withAI = allEvaluations.filter(e => e.aiAssisted).length;
            document.getElementById('aiEvaluations').textContent = withAI;
        }

        // Renderizar avaliações
        function renderEvaluations() {
            const grid = document.getElementById('evaluationsGrid');
            grid.innerHTML = '';

            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const pageEvaluations = filteredEvaluations.slice(start, end);

            if (pageEvaluations.length === 0) {
                grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 40px; color: var(--text-secondary);">Nenhuma avaliação encontrada</div>';
                return;
            }

            pageEvaluations.forEach(evaluation => {
                const patient = PatientsManager.getById(evaluation.patientId);
                const patientName = patient ? patient.nome : 'Paciente Desconhecido';

                const statusColors = {
                    'Concluída': '#27ae60',
                    'Pendente': '#f39c12',
                    'Em Andamento': '#3498db'
                };

                const typeIcons = {
                    'cognitive': 'fa-brain',
                    'neurological': 'fa-wave-square',
                    'imaging': 'fa-x-ray',
                    'lab': 'fa-flask'
                };

                const card = document.createElement('div');
                card.className = 'evaluation-card';
                card.innerHTML = `
                    <div class="evaluation-header">
                        <div class="evaluation-type">
                            <i class="fas ${typeIcons[evaluation.type] || 'fa-clipboard'}"></i>
                            ${evaluation.type === 'cognitive' ? 'Cognitiva' :
                              evaluation.type === 'neurological' ? 'Neurológica' :
                              evaluation.type === 'imaging' ? 'Imagem' : 'Laboratório'}
                        </div>
                        <span class="evaluation-status" style="background: ${statusColors[evaluation.status] || '#95a5a6'}">
                            ${evaluation.status}
                        </span>
                    </div>
                    <div class="evaluation-patient">
                        <strong>${patientName}</strong>
                        <small>${evaluation.patientId}</small>
                    </div>
                    <div class="evaluation-info">
                        <div class="info-item">
                            <i class="fas fa-calendar"></i>
                            <span>${evaluation.date}</span>
                        </div>
                        ${evaluation.aiAssisted ? '<div class="info-item"><i class="fas fa-robot" style="color: #667eea;"></i><span>IA Assistida</span></div>' : ''}
                    </div>
                    ${evaluation.aiProbabilities ? `
                        <div class="evaluation-ai-summary">
                            <small>Probabilidades:</small>
                            <div class="mini-probability-bar">
                                <div style="width: ${evaluation.aiProbabilities.alzheimer}%; background: #e74c3c;"></div>
                            </div>
                        </div>
                    ` : ''}
                    <div class="evaluation-actions">
                        <button class="btn btn-sm btn-outline" onclick="viewEvaluation('${evaluation.patientId}')">
                            <i class="fas fa-eye"></i> Ver Detalhes
                        </button>
                    </div>
                `;
                grid.appendChild(card);
            });

            updatePagination();
        }

        // Atualizar paginação
        function updatePagination() {
            const totalPages = Math.ceil(filteredEvaluations.length / itemsPerPage);
            document.getElementById('pageInfo').textContent = `Página ${currentPage} de ${totalPages}`;
            document.getElementById('prevPage').disabled = currentPage === 1;
            document.getElementById('nextPage').disabled = currentPage === totalPages;
        }

        // Filtros
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                currentFilter = this.dataset.type;

                if (currentFilter === 'all') {
                    filteredEvaluations = allEvaluations;
                } else {
                    filteredEvaluations = allEvaluations.filter(e => e.type === currentFilter);
                }

                currentPage = 1;
                renderEvaluations();
            });
        });

        // Busca
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();

            filteredEvaluations = allEvaluations.filter(evaluation => {
                const patient = PatientsManager.getById(evaluation.patientId);
                const patientName = patient ? patient.nome.toLowerCase() : '';
                const type = evaluation.type.toLowerCase();

                return patientName.includes(searchTerm) ||
                       type.includes(searchTerm) ||
                       evaluation.patientId.toLowerCase().includes(searchTerm);
            });

            currentPage = 1;
            renderEvaluations();
        });

        // Paginação
        document.getElementById('prevPage').addEventListener('click', function() {
            if (currentPage > 1) {
                currentPage--;
                renderEvaluations();
            }
        });

        document.getElementById('nextPage').addEventListener('click', function() {
            const totalPages = Math.ceil(filteredEvaluations.length / itemsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                renderEvaluations();
            }
        });

        // Ver avaliação
        function viewEvaluation(patientId) {
            window.location.href = `index.html?patient=${patientId}`;
        }

        // Modal
        function closeEvaluationModal() {
            document.getElementById('evaluationModal').style.display = 'none';
        }

        function editEvaluation() {
            alert('Funcionalidade de edição será implementada em breve');
        }

        // Inicializar
        loadEvaluations();
    </script>

    <style>
        .evaluations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .evaluation-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .evaluation-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .evaluation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .evaluation-type {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--primary);
            font-weight: 600;
        }

        .evaluation-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            color: white;
            font-weight: 500;
        }

        .evaluation-patient {
            margin-bottom: 15px;
        }

        .evaluation-patient strong {
            display: block;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .evaluation-patient small {
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .evaluation-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        .evaluation-info .info-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .evaluation-ai-summary {
            margin-bottom: 15px;
        }

        .evaluation-ai-summary small {
            display: block;
            color: var(--text-secondary);
            margin-bottom: 5px;
            font-size: 0.85rem;
        }

        .mini-probability-bar {
            height: 6px;
            background: #f0f0f0;
            border-radius: 3px;
            overflow: hidden;
        }

        .mini-probability-bar div {
            height: 100%;
            transition: width 0.3s;
        }

        .evaluation-actions {
            display: flex;
            gap: 10px;
        }

        .evaluation-actions .btn {
            flex: 1;
        }

        @media (max-width: 768px) {
            .evaluations-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</body>
</html>
