<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - NeuroDiagn√≥stico</title>
    <link rel="stylesheet" href="src/styles/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Menu Toggle Button -->
    <button class="menu-toggle" id="menuToggle" aria-label="Alternar menu">
        <i class="fas fa-bars"></i>
    </button>

    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar mobile-hidden" id="sidebar">
            <div class="logo">
                <h1>üß† NeuroDiagn√≥stico</h1>
            </div>
            <ul class="nav-links">
                <li class="active"><a href="index.html"><i class="fas fa-home"></i> Dashboard</a></li>
                <li><a href="src/pages/pacientes.html"><i class="fas fa-user-injured"></i> Pacientes</a></li>
                <li><a href="src/pages/avaliacoes.html"><i class="fas fa-brain"></i> Avalia√ß√µes</a></li>
                <li><a href="src/pages/relatorios.html"><i class="fas fa-chart-bar"></i> Relat√≥rios</a></li>
                <li><a href="src/pages/configuracoes.html"><i class="fas fa-cog"></i> Configura√ß√µes</a></li>
                <li><a href="src/pages/ajuda.html"><i class="fas fa-question-circle"></i> Ajuda</a></li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <div>
                    <h2>Dashboard</h2>
                    <p class="header-subtitle">Vis√£o geral do sistema</p>
                </div>
                <div class="user-info">
                    <div class="user-avatar">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <span id="userName">Usu√°rio</span>
                    <button class="btn-logout" onclick="logout()" title="Sair">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>

            <!-- Welcome Message for New Users -->
            <div class="welcome-banner" id="welcomeBanner" style="display: none;">
                <div class="welcome-content">
                    <div class="welcome-icon">
                        <i class="fas fa-hand-sparkles"></i>
                    </div>
                    <div class="welcome-text">
                        <h3>Bem-vindo ao NeuroDiagn√≥stico!</h3>
                        <p>Comece cadastrando seu primeiro paciente e realizando avalia√ß√µes neurol√≥gicas completas.</p>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="window.location.href='src/pages/pacientes.html'">
                    <i class="fas fa-user-plus"></i> Cadastrar Primeiro Paciente
                </button>
            </div>

            <!-- Summary Cards -->
            <div class="cards">
                <div class="card card-clickable" onclick="window.location.href='src/pages/pacientes.html'">
                    <div class="card-header">
                        <div class="card-title">Pacientes</div>
                        <div class="card-icon icon-patient">
                            <i class="fas fa-user-injured"></i>
                        </div>
                    </div>
                    <div class="card-value" id="totalPatientsCard">0</div>
                    <div class="card-desc">Total cadastrados</div>
                </div>

                <div class="card card-clickable" onclick="window.location.href='src/pages/avaliacoes.html'">
                    <div class="card-header">
                        <div class="card-title">Avalia√ß√µes</div>
                        <div class="card-icon icon-test">
                            <i class="fas fa-brain"></i>
                        </div>
                    </div>
                    <div class="card-value" id="totalEvaluationsCard">0</div>
                    <div class="card-desc">Realizadas</div>
                </div>

                <div class="card card-clickable" onclick="window.location.href='src/pages/relatorios.html'">
                    <div class="card-header">
                        <div class="card-title">Relat√≥rios</div>
                        <div class="card-icon icon-results">
                            <i class="fas fa-file-alt"></i>
                        </div>
                    </div>
                    <div class="card-value" id="totalReportsCard">0</div>
                    <div class="card-desc">Gerados</div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">√öltimo Acesso</div>
                        <div class="card-icon" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">
                            <i class="fas fa-clock"></i>
                        </div>
                    </div>
                    <div class="card-value" style="font-size: 1rem;" id="lastAccessCard">Agora</div>
                    <div class="card-desc">Atividade recente</div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="quick-actions-panel">
                <h3><i class="fas fa-bolt"></i> A√ß√µes R√°pidas</h3>
                <div class="quick-actions-grid">
                    <a href="src/pages/pacientes.html" class="quick-action-btn">
                        <div class="quick-action-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <span>Novo Paciente</span>
                    </a>
                    <a href="src/pages/avaliacoes.html" class="quick-action-btn">
                        <div class="quick-action-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            <i class="fas fa-brain"></i>
                        </div>
                        <span>Nova Avalia√ß√£o</span>
                    </a>
                    <a href="src/pages/relatorios.html" class="quick-action-btn">
                        <div class="quick-action-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <span>Ver Relat√≥rios</span>
                    </a>
                    <a href="src/pages/configuracoes.html" class="quick-action-btn">
                        <div class="quick-action-icon" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                            <i class="fas fa-cog"></i>
                        </div>
                        <span>Configura√ß√µes</span>
                    </a>
                    <a href="src/pages/ajuda.html" class="quick-action-btn">
                        <div class="quick-action-icon" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                            <i class="fas fa-question-circle"></i>
                        </div>
                        <span>Ajuda</span>
                    </a>
                </div>
            </div>

            <!-- Recent Patients -->
            <div class="recent-section" id="recentPatientsSection" style="display: none;">
                <div class="section-header">
                    <h3><i class="fas fa-users"></i> Pacientes Recentes</h3>
                    <a href="src/pages/pacientes.html" class="btn btn-outline btn-sm">
                        Ver Todos <i class="fas fa-arrow-right"></i>
                    </a>
                </div>
                <div class="recent-patients-grid" id="recentPatientsList">
                    <!-- Ser√° preenchido dinamicamente -->
                </div>
            </div>

            <!-- Statistics Charts -->
            <div class="charts-section" id="chartsSection" style="display: none;">
                <div class="section-header">
                    <h3><i class="fas fa-chart-bar"></i> Estat√≠sticas</h3>
                </div>
                <div class="charts-grid">
                    <div class="chart-card">
                        <h4>Avalia√ß√µes por M√™s</h4>
                        <canvas id="evaluationsChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h4>Distribui√ß√£o de Diagn√≥sticos</h4>
                        <canvas id="diagnosisChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- System Info -->
            <div class="info-panel">
                <div class="info-panel-header">
                    <h3><i class="fas fa-info-circle"></i> Informa√ß√µes do Sistema</h3>
                </div>
                <div class="info-panel-content">
                    <div class="info-item">
                        <i class="fas fa-check-circle" style="color: #27ae60;"></i>
                        <div>
                            <strong>Sistema Operacional</strong>
                            <p>Todos os sistemas funcionando normalmente</p>
                        </div>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-database" style="color: #3498db;"></i>
                        <div>
                            <strong>Armazenamento Local</strong>
                            <p>Seus dados s√£o armazenados com seguran√ßa no navegador</p>
                        </div>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-shield-alt" style="color: #9b59b6;"></i>
                        <div>
                            <strong>Privacidade</strong>
                            <p>Dados protegidos conforme LGPD</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Getting Started Guide -->
            <div class="guide-panel" id="guidePanel" style="display: none;">
                <div class="guide-header">
                    <h3><i class="fas fa-rocket"></i> Primeiros Passos</h3>
                    <button class="btn-icon" onclick="document.getElementById('guidePanel').style.display='none'" title="Dispensar">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="guide-steps">
                    <div class="guide-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4>Cadastre Pacientes</h4>
                            <p>Comece adicionando os dados dos pacientes na se√ß√£o Pacientes</p>
                        </div>
                    </div>
                    <div class="guide-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4>Realize Avalia√ß√µes</h4>
                            <p>Aplique testes cognitivos e registre os resultados</p>
                        </div>
                    </div>
                    <div class="guide-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4>Gere Relat√≥rios</h4>
                            <p>Crie laudos detalhados com interpreta√ß√£o assistida por IA</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="src/scripts/storage.js"></script>
    <script src="src/scripts/common.js"></script>
    <script>
        // Dashboard Script
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboard();
        });

        function loadDashboard() {
            // Carregar dados do usu√°rio
            loadUserInfo();

            // Carregar estat√≠sticas
            loadStatistics();

            // Carregar pacientes recentes
            loadRecentPatients();

            // Verificar se √© novo usu√°rio
            checkFirstAccess();
        }

        function loadUserInfo() {
            const userData = JSON.parse(localStorage.getItem('neurodiag_user_data') || '{}');
            const userName = document.getElementById('userName');

            if (userData.nome) {
                userName.textContent = userData.nome.split(' ')[0]; // Primeiro nome
            } else {
                userName.textContent = 'Usu√°rio';
            }

            // Atualizar √∫ltimo acesso
            const loginTime = localStorage.getItem('neurodiag_login_time');
            if (loginTime) {
                const lastAccess = new Date(loginTime);
                const now = new Date();
                const diffMinutes = Math.floor((now - lastAccess) / 60000);

                let accessText = 'Agora';
                if (diffMinutes > 0 && diffMinutes < 60) {
                    accessText = `${diffMinutes} min atr√°s`;
                } else if (diffMinutes >= 60) {
                    const hours = Math.floor(diffMinutes / 60);
                    accessText = `${hours}h atr√°s`;
                }

                document.getElementById('lastAccessCard').textContent = accessText;
            }
        }

        function loadStatistics() {
            const patients = PatientsManager.getAll();
            const evaluations = EvaluationsManager.getAll();
            const reports = ReportsManager.getAll();

            document.getElementById('totalPatientsCard').textContent = patients.length;
            document.getElementById('totalEvaluationsCard').textContent = evaluations.length;
            document.getElementById('totalReportsCard').textContent = reports.length;

            // Mostrar se√ß√£o de gr√°ficos se houver dados
            if (evaluations.length > 0) {
                document.getElementById('chartsSection').style.display = 'block';
                initializeCharts(evaluations);
            }
        }

        function loadRecentPatients() {
            const patients = PatientsManager.getAll();

            if (patients.length > 0) {
                const recentSection = document.getElementById('recentPatientsSection');
                const patientsList = document.getElementById('recentPatientsList');

                recentSection.style.display = 'block';

                // Mostrar √∫ltimos 3 pacientes
                const recentPatients = patients.slice(0, 3);

                patientsList.innerHTML = recentPatients.map(patient => `
                    <div class="patient-card" onclick="window.location.href='src/pages/pacientes.html?id=${patient.id}'">
                        <div class="patient-card-icon">
                            <i class="fas fa-user-circle"></i>
                        </div>
                        <div class="patient-card-info">
                            <h4>${patient.nome}</h4>
                            <p>${patient.idade} anos ‚Ä¢ ID: ${patient.id}</p>
                            <p class="patient-card-date">
                                <i class="fas fa-calendar"></i> ${patient.ultimaConsulta || 'Sem consulta'}
                            </p>
                        </div>
                        <div class="patient-card-action">
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </div>
                `).join('');
            }
        }

        function checkFirstAccess() {
            const patients = PatientsManager.getAll();

            if (patients.length === 0) {
                // Mostrar mensagem de boas-vindas e guia
                document.getElementById('welcomeBanner').style.display = 'flex';
                document.getElementById('guidePanel').style.display = 'block';
            }
        }

        function initializeCharts(evaluations) {
            // Gr√°fico de Avalia√ß√µes por M√™s (exemplo simplificado)
            const ctx1 = document.getElementById('evaluationsChart');
            if (ctx1) {
                new Chart(ctx1, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'],
                        datasets: [{
                            label: 'Avalia√ß√µes',
                            data: [2, 4, 3, 5, 7, 6],
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            }

            // Gr√°fico de Distribui√ß√£o de Diagn√≥sticos
            const ctx2 = document.getElementById('diagnosisChart');
            if (ctx2) {
                new Chart(ctx2, {
                    type: 'doughnut',
                    data: {
                        labels: ['Alzheimer', 'DLB', 'FTD', 'DCL'],
                        datasets: [{
                            data: [45, 25, 15, 15],
                            backgroundColor: [
                                '#667eea',
                                '#f093fb',
                                '#4facfe',
                                '#43e97b'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });
            }
        }
    </script>

    <style>
        .header-subtitle {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .welcome-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }

        .welcome-content {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .welcome-icon {
            font-size: 3rem;
        }

        .welcome-text h3 {
            margin: 0 0 10px 0;
            font-size: 1.5rem;
        }

        .welcome-text p {
            margin: 0;
            opacity: 0.9;
        }

        .recent-section {
            margin: 30px 0;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-header h3 {
            font-size: 1.3rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .recent-patients-grid {
            display: grid;
            gap: 15px;
        }

        .patient-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .patient-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .patient-card-icon {
            font-size: 2.5rem;
            color: var(--primary);
        }

        .patient-card-info {
            flex: 1;
        }

        .patient-card-info h4 {
            margin: 0 0 5px 0;
            color: var(--text-primary);
        }

        .patient-card-info p {
            margin: 0;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .patient-card-date {
            margin-top: 5px !important;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .patient-card-action {
            color: var(--text-secondary);
            font-size: 1.2rem;
        }

        .charts-section {
            margin: 30px 0;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }

        .chart-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .chart-card h4 {
            margin: 0 0 20px 0;
            color: var(--text-primary);
        }

        .chart-card canvas {
            height: 250px !important;
        }

        .info-panel {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .info-panel-header h3 {
            margin: 0 0 20px 0;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-panel-content {
            display: grid;
            gap: 15px;
        }

        .info-item {
            display: flex;
            gap: 15px;
            align-items: flex-start;
        }

        .info-item i {
            font-size: 1.5rem;
            margin-top: 3px;
        }

        .info-item strong {
            display: block;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .info-item p {
            margin: 0;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .guide-panel {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 12px;
            padding: 25px;
            margin: 30px 0;
        }

        .guide-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .guide-header h3 {
            margin: 0;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .guide-steps {
            display: grid;
            gap: 15px;
        }

        .guide-step {
            display: flex;
            gap: 15px;
            background: white;
            padding: 20px;
            border-radius: 10px;
        }

        .step-number {
            width: 40px;
            height: 40px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .step-content h4 {
            margin: 0 0 5px 0;
            color: var(--text-primary);
        }

        .step-content p {
            margin: 0;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .btn-icon {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 5px;
            transition: color 0.3s;
        }

        .btn-icon:hover {
            color: var(--text-primary);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .welcome-banner {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .welcome-content {
                flex-direction: column;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</body>
</html>
